<html>
  <head>
    <title>Apocalypse</title>
    <style>
		#zombie_map {
		    height: 80%;
		    width: 80%;
		    position: absolute;
		    background-color: grey;
		    margin-left:10%;
		}
	</style>
  </head>
  <body>
    <h1 style="text-align:center;margin:30px;">Apocalypse</h1>
    <div id="zombie_map"></div>
    <script>
    	var map;
	var score;
	var tolerance = 10;
	var old_position;
    	var all_markers = [];
    	var data = `40.08228238806431, -111.60162939870199 zombie.png
		    40.08169968014332, -111.6046754937033 hospital.png
		    40.08137499672702, -111.6057340605472 zombie.png
		    40.08278836705792, -111.6043504809967 weapons.png
		    40.082711744758946, -111.60527750756263 zombie.png
		    40.08179023558483, -111.6050016105744 zombie.png
		    40.082329, -111.602795 zombie.png
		    40.082892, -111.603793 hospital.png
		    40.082046, -111.603455 weapons.png
		    40.082306, -111.605958 hospital.png
		    40.082901, -111.602889 zombie.png
		    40.079843, -111.601704 zombie.png
		    40.081206, -111.604005 zombie.png
		    40.081633, -111.603415 weapons.png`
		var markers = data.split("\n");

		function initMap() {

			const myLatLng = { lat: 40.08231219015568, lng: -111.60429225759033 };
			map = new google.maps.Map(document.getElementById("zombie_map"), {
				zoom: 18,
				center: myLatLng,
			});
			
			old_position = new google.maps.Marker({
					position: myLatLng,
					map,
					title: "Player",
					icon: 'player.png'
				});



			if(navigator.geolocation) {
    			navigator.geolocation.watchPosition(set_my_position);
			} else {
				alert("Geolocation doesn't work in your browser");
			}


			for(var i=0; i < markers.length; i++){

				var marker_data = markers[i].trim();
	 			marker_data = marker_data.split(" ");
	 			var latitude = marker_data[0];
				var longitude = marker_data[1];
				var emoji = marker_data[2];

				var marker = new google.maps.Marker({
					position: { lat: parseFloat(latitude), lng: parseFloat(longitude) },
					map,
					title: "Marker",
					icon: emoji
				});

				all_markers.push(marker);

			}
		}

		function set_my_position(position) {
			old_position.setMap(null);
			var pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

			var myLocation = new google.maps.Marker({
				position: pos,
				map,
				title: 'Me',
				icon: 'player.png'
			});
			old_position = marker;
			for(var i=0; i < all_markers.length; i++){
    				var distance = google.maps.geometry.spherical.computeDistanceBetween(pos, all_markers[i].getPosition());
				if( distance < tolerance ){
    					var what_is_it = all_markers[i].getIcon();
					what_is_it = what_is_it.replace(".png", "");
					alert("Found the " + what_is_it );
					all_markers[i].setMap(null);
					if (what_is_it != "zombie") {
						score = score + 10;
						alert("You just earned 10 points. Your score is now " + score + " points!");
					};
				};
			};
		};
 
    </script>
    <script async
  		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBRmad69TWBccqkXae-Dp0V5CtNUfZ3gSE&callback=initMap&libraries=geometry">
	</script>
  </body>
</html>


